# 프로젝트 루트에 nginx.conf 파일로 저장
events {
  worker_connections 1024;
}

http {
  # WebSocket 업그레이드용
  map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
  }

  # 내부 서비스 업스트림 (모두 컨테이너 내부 포트 8080)
  upstream auth      { server auth-service:8080; }
  upstream portfolio { server portfolio-service:8080; }
  upstream price     { server price-service:8080; }
  upstream order     { server order-service:8080; }
  upstream report    { server report-service:8080; }
  upstream tax       { server tax-service:8080; }
  upstream sns       { server sns-service:8080; }

  server {
    listen 80;

    location /api/auth/       { proxy_pass http://auth; }
    location /api/portfolio/  { proxy_pass http://portfolio; }
    location /api/price/      { proxy_pass http://price; }
    location /api/order/      { proxy_pass http://order; }
    location /api/report/     { proxy_pass http://report; }
    location /api/tax-report/ { proxy_pass http://tax; }
    location /api/sns/ {
      proxy_pass http://sns;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
    }
  }
}
